<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Volt Money Support Manual</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    html, body {
      height: 100%;
      overflow: hidden;
      font-family: 'Segoe UI', sans-serif;
    }

    body {
      background-image: url('Newvoltbg.jpg');
      background-size: cover;
      background-position: center center;
      background-repeat: no-repeat;
      background-attachment: fixed;
      display: flex;
      flex-direction: column;
    }

    .header {
      background: #2f3ac7;
      color: white;
      padding: 10px 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      height: 56px;
      flex-shrink: 0;
    }
    .header-left {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .header-logo {
      height: 34px;
      width: auto;
      object-fit: contain;
    }
    .header h1 { font-size: 18px; font-weight: 700; }
    .header span { font-size: 13px; opacity: 0.8; }

    .main-layout {
      display: flex;
      height: calc(100vh - 56px);
      overflow: hidden;
    }

    .sidebar {
      width: 270px;
      min-width: 270px;
      background: rgba(255,255,255,0.97);
      border-right: 1px solid #e0e0e0;
      display: flex;
      flex-direction: column;
      height: 100%;
      overflow: hidden;
    }

    .sidebar-search {
      padding: 10px 12px;
      border-bottom: 1px solid #e0e0e0;
      background: rgba(255,255,255,0.98);
      flex-shrink: 0;
    }
    .sidebar-search input {
      width: 100%;
      padding: 8px 14px;
      border: 2px solid #2f3ac7;
      border-radius: 20px;
      font-size: 13px;
      outline: none;
      font-family: 'Segoe UI', sans-serif;
    }
    .sidebar-search input:focus {
      box-shadow: 0 0 0 3px rgba(47,58,199,0.15);
    }

    .sidebar-items {
      flex: 1;
      overflow-y: auto;
      padding: 10px 0;
    }

    .sidebar-section-title {
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: #888;
      padding: 10px 18px 6px;
      margin-top: 4px;
    }
    .sidebar-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 18px;
      cursor: pointer;
      font-size: 13.5px;
      color: #333;
      border-left: 3px solid transparent;
      transition: 0.15s;
    }
    .sidebar-item:hover { background: #f0f2ff; color: #2f3ac7; }
    .sidebar-item.active {
      background: #eef0ff;
      color: #2f3ac7;
      font-weight: 600;
      border-left: 3px solid #2f3ac7;
    }
    .dot { width: 9px; height: 9px; border-radius: 50%; flex-shrink: 0; }
    .dot-pre  { background: #f5c518; }
    .dot-post { background: #2f3ac7; }
    .sidebar-divider { height: 1px; background: #e8e8e8; margin: 8px 14px; }

    .content-wrapper {
      flex: 1;
      position: relative;
      height: 100%;
      overflow: hidden;
    }

    .welcome {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      z-index: 1;
    }
    .welcome-box {
      background: rgba(60, 60, 70, 0.62);
      border-radius: 16px;
      padding: 36px 48px;
      backdrop-filter: blur(6px);
      border: 1px solid rgba(255,255,255,0.15);
    }
    .welcome-box h2 {
      font-size: 26px;
      font-weight: 700;
      color: white;
      margin-bottom: 10px;
      text-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }
    .welcome-box p {
      font-size: 15px;
      color: rgba(255,255,255,0.85);
    }

    .content-inner {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      overflow-y: auto;
      padding: 28px;
      display: none;
    }

    .screen-title {
      font-size: 20px;
      font-weight: 700;
      color: #1a1a2e;
      margin-bottom: 6px;
      background: rgba(255,255,255,0.9);
      display: inline-block;
      padding: 4px 14px;
      border-radius: 8px;
    }
    .screen-subtitle {
      font-size: 13px;
      color: #555;
      margin-bottom: 18px;
      background: rgba(255,255,255,0.8);
      display: inline-block;
      padding: 2px 10px;
      border-radius: 6px;
    }

    .cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 14px;
      margin-top: 10px;
    }
    .card {
      background: white;
      border: 1.5px solid #e8e8e8;
      border-radius: 12px;
      padding: 16px 18px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: space-between;
      transition: 0.2s;
      box-shadow: 0 2px 6px rgba(0,0,0,0.06);
    }
    .card:hover {
      border-color: #2f3ac7;
      box-shadow: 0 4px 14px rgba(47,58,199,0.15);
      transform: translateY(-1px);
    }
    .card-text { font-size: 14px; font-weight: 500; color: #222; }
    .card-arrow { color: #2f3ac7; font-size: 18px; font-weight: 700; }

    .back-btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: white;
      border: 1.5px solid #2f3ac7;
      color: #2f3ac7;
      padding: 7px 16px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      margin-bottom: 18px;
      transition: 0.2s;
    }
    .back-btn:hover { background: #2f3ac7; color: white; }

    .detail-card {
      background: white;
      border-radius: 14px;
      padding: 24px;
      margin-bottom: 16px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.08);
      border: 1px solid #eee;
    }
    .detail-card h3 {
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.8px;
      color: #2f3ac7;
      margin-bottom: 12px;
      font-weight: 700;
    }
    .detail-card p {
      font-size: 14px;
      color: #333;
      line-height: 1.8;
      white-space: pre-wrap;
    }
    .detail-card a {
      color: #2f3ac7;
      font-weight: 600;
      text-decoration: underline;
      word-break: break-all;
    }
    .detail-card a:hover { color: #1a27a0; }

    .search-result-item {
      background: white;
      border-radius: 12px;
      padding: 16px 20px;
      margin-bottom: 12px;
      border: 1.5px solid #e0e0e0;
      cursor: pointer;
      transition: 0.2s;
    }
    .search-result-item:hover {
      border-color: #2f3ac7;
      box-shadow: 0 3px 10px rgba(47,58,199,0.1);
    }
    .search-result-item .s-type {
      font-size: 11px;
      color: #888;
      margin-bottom: 4px;
      text-transform: uppercase;
    }
    .search-result-item .s-subtype {
      font-size: 15px;
      font-weight: 600;
      color: #1a1a2e;
    }

    ::-webkit-scrollbar { width: 5px; }
    ::-webkit-scrollbar-track { background: #f1f1f1; }
    ::-webkit-scrollbar-thumb { background: #c0c0c0; border-radius: 10px; }
  </style>
</head>
<body>

  <div class="header">
    <div class="header-left">
      <img src="Volt Logo.png" alt="Volt Logo" class="header-logo" />
      <h1>Volt Money ‚Äî Support Manual</h1>
    </div>
    <span>Internal Use Only</span>
  </div>

  <div class="main-layout">

    <div class="sidebar">
      <div class="sidebar-search">
        <input type="text" id="searchInput"
          placeholder="üîç Search..."
          oninput="handleSearch()" />
      </div>
      <div class="sidebar-items" id="sidebar">
        <div style="padding:20px;color:#999;font-size:13px;">Loading...</div>
      </div>
    </div>

    <div class="content-wrapper">
      <div class="welcome" id="welcomeScreen">
        <div class="welcome-box">
          <h2>üëã Welcome to Support Manual</h2>
          <p>Select a category from the left to get started.</p>
        </div>
      </div>
      <div class="content-inner" id="contentInner"></div>
    </div>

  </div>

  <script>
    const SHEET_URL = 'https://script.google.com/macros/s/AKfycbwAqD2jfG2cKo7K7LojTWweEFPinjhQYVsgYA9wPHOCHRIJIw-QQdin59l9dgPMmkbk/exec';

    let allData = [];
    let currentType = null;

    // ‚úÖ Dono formats handle karta hai ‚Äî plain URL bhi, [Text](URL) bhi
    function parseLinks(text) {
      // Step 1: [Text](URL) format
      text = text.replace(/\[([^\]]+)\]\((https?:\/\/[^\)]+)\)/g,
        '<a href="$2" target="_blank">$1</a>'
      );
      // Step 2: Plain URL format
      text = text.replace(/(^|[\s\n])((https?:\/\/)[^\s<]+)/g,
        '$1<a href="$2" target="_blank">$2</a>'
      );
      return text;
    }

    function showWelcome() {
      document.getElementById('welcomeScreen').style.display = 'flex';
      document.getElementById('contentInner').style.display = 'none';
      document.getElementById('contentInner').innerHTML = '';
    }

    function showContent(html) {
      document.getElementById('welcomeScreen').style.display = 'none';
      const inner = document.getElementById('contentInner');
      inner.style.display = 'block';
      inner.innerHTML = html;
      inner.scrollTop = 0;
    }

    async function fetchData() {
      try {
        const res = await fetch(SHEET_URL);
        const data = await res.json();

        allData = data.map(row => ({
          category:       (row['Category'] || '').toString().trim(),
          type:           (row['Type'] || '').toString().trim(),
          subType:        (row['Sub Type'] || '').toString().trim(),
          preChecks:      (row['Pre-checks'] || '').toString().trim(),
          escalationPath: (row['Escalation Path'] || '').toString().trim(),
          extraDetails:   (row['Extra Details'] || '').toString().trim(),
          loanCategory:   (row['Category'] || '').toString().trim().toLowerCase().includes('pre') ? 'pre' : 'post'
        })).filter(r => r.subType !== '');

        buildSidebar();
      } catch(e) {
        document.getElementById('sidebar').innerHTML =
          '<div style="padding:20px;color:red;font-size:13px;">‚ùå Error loading data.<br>Check Apps Script URL.</div>';
      }
    }

    function buildSidebar() {
      const preTypes  = [...new Set(allData.filter(r => r.loanCategory === 'pre').map(r => r.type).filter(Boolean))];
      const postTypes = [...new Set(allData.filter(r => r.loanCategory === 'post').map(r => r.type).filter(Boolean))];

      let html = '';

      if (preTypes.length > 0) {
        html += `<div class="sidebar-section-title">üü° Pre Loan</div>`;
        preTypes.forEach(type => {
          html += `<div class="sidebar-item ${currentType === type ? 'active' : ''}"
                        onclick="showSubTypes('${escQ(type)}')">
                     <span class="dot dot-pre"></span>${type}
                   </div>`;
        });
      }

      if (preTypes.length > 0 && postTypes.length > 0) {
        html += `<div class="sidebar-divider"></div>`;
      }

      if (postTypes.length > 0) {
        html += `<div class="sidebar-section-title">üîµ Post Loan</div>`;
        postTypes.forEach(type => {
          html += `<div class="sidebar-item ${currentType === type ? 'active' : ''}"
                        onclick="showSubTypes('${escQ(type)}')">
                     <span class="dot dot-post"></span>${type}
                   </div>`;
        });
      }

      document.getElementById('sidebar').innerHTML = html;
    }

    function showSubTypes(type) {
      currentType = type;
      buildSidebar();

      const subtypes = allData.filter(r => r.type === type);
      const loanLabel = subtypes[0]?.loanCategory === 'pre' ? 'üü° Pre Loan' : 'üîµ Post Loan';

      let html = `
        <div class="screen-title">${type}</div>
        <div class="screen-subtitle">${loanLabel} &nbsp;|&nbsp; ${subtypes.length} sub-type(s)</div>
        <div class="cards-grid">`;

      subtypes.forEach(row => {
        html += `<div class="card" onclick="showDetail(${allData.indexOf(row)})">
                   <span class="card-text">${row.subType}</span>
                   <span class="card-arrow">‚Ä∫</span>
                 </div>`;
      });

      html += `</div>`;
      showContent(html);
    }

    function showDetail(index) {
      const row = allData[index];
      const loanLabel = row.loanCategory === 'pre' ? 'üü° Pre Loan' : 'üîµ Post Loan';

      let html = `
        <button class="back-btn" onclick="showSubTypes('${escQ(row.type)}')">‚Üê Back</button>
        <div class="screen-title">${row.subType}</div>
        <div class="screen-subtitle">${loanLabel} ‚Ä∫ ${row.type}</div>`;

      if (row.preChecks) {
        html += `<div class="detail-card"><h3>‚úÖ Pre-Checks</h3><p>${parseLinks(row.preChecks)}</p></div>`;
      }
      if (row.escalationPath) {
        html += `<div class="detail-card"><h3>üî∫ Escalation Path</h3><p>${parseLinks(row.escalationPath)}</p></div>`;
      }
      if (row.extraDetails) {
        html += `<div class="detail-card"><h3>üìù Extra Details</h3><p>${parseLinks(row.extraDetails)}</p></div>`;
      }

      showContent(html);
    }

    function handleSearch() {
      const q = document.getElementById('searchInput').value.toLowerCase().trim();

      if (!q) {
        currentType = null;
        buildSidebar();
        showWelcome();
        return;
      }

      const results = allData.filter(r =>
        r.category.toLowerCase().includes(q) ||
        r.type.toLowerCase().includes(q) ||
        r.subType.toLowerCase().includes(q) ||
        r.preChecks.toLowerCase().includes(q) ||
        r.escalationPath.toLowerCase().includes(q) ||
        r.extraDetails.toLowerCase().includes(q)
      );

      let html = `
        <div class="screen-title">Search Results</div>
        <div class="screen-subtitle">${results.length} result(s) for "${q}"</div>`;

      if (results.length === 0) {
        html += `<div style="background:white;padding:20px;border-radius:12px;color:#888;">No results found.</div>`;
      } else {
        results.forEach(row => {
          html += `<div class="search-result-item" onclick="showDetail(${allData.indexOf(row)})">
                     <div class="s-type">
                       ${row.loanCategory === 'pre' ? 'üü° Pre Loan' : 'üîµ Post Loan'} ‚Ä∫ ${row.type}
                     </div>
                     <div class="s-subtype">${row.subType}</div>
                   </div>`;
        });
      }

      showContent(html);
    }

    function escQ(str) {
      return str.replace(/'/g, "\\'");
    }

    fetchData();
  </script>

</body>
</html>
